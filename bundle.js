!function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=6)}([function(e,t){e.exports.DeviceBehaviour={extend:function(e){var t=0;e.getUid=function(){return t},e.setUid=function(e){t=e}}}},function(e,t){e.exports.ObserverPattern={observable:{extend:function(e){var t={};e.addObserver=function(e,r){t[e]=r},e.deleteObserver=function(e){delete t[e]},e.updateObservers=function(e){for(var r in t)t[r].update(r,e)}}},observer:{extend:function(e){var t={};e.setUpdateHandler=function(e,r){t[e]=r},e.update=function(e,r){t[e](r)}}}}},function(e,t,r){r(4)._BusManagerBehaviour;var o={extend:function(e){var t=e.getMemory,r=e.getMemoryType,o=e.getAddressBus,n=e.getControlBus,u=e.getDataBus,i=function(){var e=o().getValue(),r=t().readBytes(e,2);console.log("Memory controller: "+r),u().setValue(256*r[0]+r[1])},a=i,s=function(e,s){var d=n();switch(console.log("Mmory update: "+s),r()){case 0:s==d.READ_RAM&&(console.log("read ram "),i()),s==d.WRITE_RAM&&(console.log("write ram "),function(){if(t().writeBytes){var e=o().getValue(),r=u().getValue();t().writeBytes(e,[(r-r%256)/256,r%256])}}());break;case 1:s==d.READ_ROM&&(console.log("read rom "),a())}};n().addObserver("memoryController",{update:s})}};e.exports._MemoryControllerBehaviour={extend:function(e){var t=null,r=null;e.setMemory=function(e){t=e},e.getMemory=function(e){return t},e.setMemoryType=function(e){r=e},e.getMemoryType=function(){return r}}},e.exports.MemoryControllerBehaviour=o},function(e,t,r){var o=r(0).DeviceBehaviour,n=r(1).ObserverPattern,u=function(e){var t=255;e.setMaxValue=function(e){return e>0&&(t=e,!0)},e.getMaxValue=function(){return t}},i=function(e){var t=0,r=e.getMaxValue,o=e.updateObservers;e.setValue=function(e){return console.log("Max bus value is: "+r()+" try to set value: "+e),r()>=e&&e>=0&&(t=e,console.log("Update memory obs: "+e),o(e),!0)},e.getValue=function(){return t}},a={};o.extend(a),u(a),a.produce=function(){var e={};return n.observable.extend(e),o.extend(e),u(e),i(e),e.setUid(a.getUid()),e.setMaxValue(a.getMaxValue()),delete e.updateObservers,delete e.setUid,delete e.setMaxValue,delete e.getMaxValue,e},e.exports.BusFactory=a},function(e,t){e.exports._BusManagerBehaviour={extend:function(e){var t=null,r=null,o=null;e.setAddressBus=function(e){t=e},e.setControlBus=function(e){r=e},e.setDataBus=function(e){o=e},e.getAddressBus=function(e){return t},e.getControlBus=function(e){return r},e.getDataBus=function(e){return o}}}},function(e,t){var r={extend:function(e){var t=0;e.setSize=function(e){t=e},e.getSize=function(){return t}}},o=function(e){var t=[],r=e.getSize,o=null,n=null;e.readByte=function(e){return r()>e&&e>=0?t[e]:null},e.readBytes=function(e,t){for(var r=[],o=0;o<t;o++)r.push(n(e+o));return r},e.writeByte=function(e,o){return r()>e&&e>=0&&(t[e]=o,!0)},e.writeBytes=function(e,t){for(var r=0;r<t.length;r++)if(!o(e+r,t[r]))return!1;return!0};!function(){for(var u=r(),i=0;i<u;i++)t[i]=0;o=e.writeByte,n=e.readByte}()};MemoryFactory={},r.extend(MemoryFactory),MemoryFactory.produce=function(){var e={};return r.extend(e),e.setSize(MemoryFactory.getSize()),o(e),delete e.setSize,e},e.exports._MemoryBehaviour=r,e.exports.MemoryFactory=MemoryFactory},function(e,t,r){var o=r(7).AddressBusFactory,n=r(8).ControlBusFactory,u=r(9).DataBusFactory,i=r(10).RAMFactory,a=r(11).ROMFactory,s=r(12).CPUFactory,d=r(14).OscillatorFactory;r(2).MemoryControllerFactory;o.setUid(0),n.setUid(1),u.setUid(2),i.setUid(3),a.setUid(4),s.setUid(5),d.setFrequency(1),i.setSize(256),a.setSize(256);var l=o.produce(),c=n.produce(),f=u.produce();i.setAddressBus(l),i.setControlBus(c),i.setDataBus(f),a.setAddressBus(l),a.setControlBus(c),a.setDataBus(f),s.setAddressBus(l),s.setControlBus(c),s.setDataBus(f);var v=i.produce(),B=a.produce(),g=s.produce(),y=d.produce();y.addObserver("cpu",g),window.cpu=g,window.oscillator=y,window.ram=v,window.rom=B},function(e,t,r){var o=r(0).DeviceBehaviour,n=r(3).BusFactory,u={};o.extend(u),u.produce=function(){return n.setUid(u.getUid()),n.setMaxValue(Math.pow(2,10)-1),n.produce()},e.exports.AddressBusFactory=u},function(e,t,r){var o=r(0).DeviceBehaviour,n=r(3).BusFactory,u=function(e){e.WRITE_PORT=0,e.READ_RAM=1,e.WRITE_RAM=2,e.READ_ROM=3},i={};o.extend(i),i.produce=function(){var e;return n.setUid(i.getUid()),n.setMaxValue(Math.pow(2,2)-1),e=n.produce(),u(e),e},e.exports.ControlBusFactory=i},function(e,t,r){var o=r(0).DeviceBehaviour,n=r(3).BusFactory,u={};o.extend(u),u.produce=function(){return n.setUid(u.getUid()),n.setMaxValue(Math.pow(2,16)-1),n.produce()},e.exports.DataBusFactory=u},function(e,t,r){var o=r(1).ObserverPattern,n=r(4)._BusManagerBehaviour,u=r(0).DeviceBehaviour,i=r(5).MemoryFactory,a=r(5)._MemoryBehaviour,s=r(2)._MemoryControllerBehaviour,d=r(2).MemoryControllerBehaviour,l={};u.extend(l),n.extend(l),a.extend(l),s.extend(l),l.produce=function(){var e={};return i.setSize(l.getSize()),e=i.produce(),o.observer.extend(e),u.extend(e),e.setUid(l.getUid()),n.extend(e),e.setAddressBus(l.getAddressBus()),e.setControlBus(l.getControlBus()),e.setDataBus(l.getDataBus()),s.extend(e),e.setMemory(e),e.setMemoryType(0),d.extend(e),delete e.setUid,delete e.setAddressBus,delete e.setControlBus,delete e.setDataBus,delete e.getAddressBus,delete e.getControlBus,delete e.getDataBus,delete e.setMemory,delete e.getMemory,delete e.setMemoryType,delete e.getMemoryType,delete e.setUpdateHandler,delete e.update,e},e.exports.RAMFactory=l},function(e,t,r){var o=r(1).ObserverPattern,n=r(4)._BusManagerBehaviour,u=r(0).DeviceBehaviour,i=r(5).MemoryFactory,a=r(5)._MemoryBehaviour,s=r(2)._MemoryControllerBehaviour,d=r(2).MemoryControllerBehaviour,l=function(e){var t=e.writeBytes;e.flash=function(r){var o=e.getSize();return!(r.length>o)&&(t(0,r),t(r.length,o),!0)}},c={};u.extend(c),n.extend(c),a.extend(c),s.extend(c),c.produce=function(){var e={};return i.setSize(c.getSize()),e=i.produce(),l(e),o.observer.extend(e),u.extend(e),e.setUid(c.getUid()),n.extend(e),e.setAddressBus(c.getAddressBus()),e.setControlBus(c.getControlBus()),e.setDataBus(c.getDataBus()),s.extend(e),e.setMemory(e),e.setMemoryType(1),d.extend(e),delete e.setUid,delete e.setAddressBus,delete e.setControlBus,delete e.setDataBus,delete e.getAddressBus,delete e.getControlBus,delete e.getDataBus,delete e.writeByte,delete e.writeBytes,delete e.setMemory,delete e.getMemory,delete e.setMemoryType,delete e.getMemoryType,delete e.setUpdateHandler,delete e.update,e},e.exports.ROMFactory=c},function(e,t,r){var o=r(0).DeviceBehaviour,n=r(4)._BusManagerBehaviour,u=r(1).ObserverPattern,i=r(13).PortFactory,a=function(e){var t=null;e.setPort=function(e){t=e},e.getPort=function(){return t}},s=function(e){var t=0,r=!1,o=0,n=0,u=0,i=0,a=0,s=0,d=1,l=2,c=3,f=4,v=5,B=6,g=7,y=8,p=9,M=10,x=11,V=12,A=13,R=14,b=15,m=16,D=17,_=18,C=19,F=20,U=21,h=22,O=23,P=24,E=25,T=26,w=27,S=28,k=29,z=30,I=d,q=0,j=e.getAddressBus,W=e.getControlBus,H=e.getDataBus,Y=e.getPort,G=e.updateObservers,J=function(){q<1022?q+=2:q=0},K=function(e){if((3072&e)>>10==0&&(48&e)>>4==0)return o=o,I=d,void J();if((3072&e)>>10==0&&(48&e)>>4==1)return o=Y().getValue(),I=d,void J();if((3072&e)>>10==0&&(48&e)>>4==2){if(0==(3&e))return o=u,I=d,void J();if(1==(3&e))return o=i,I=d,void J()}if((3072&e)>>10==0&&(48&e)>>4==3){if(I==s)return j().setValue(15&e),I=f,void console.log("execCmd"+j().getValue());if(I==f)return W().setValue(W().READ_RAM),void(I=v);if(I==v)return o=H().getValue(),I=d,void J()}if((3072&e)>>10==0&&(48&e)>>4==0)return o=o,I=d,void J();if((3072&e)>>10==1&&(48&e)>>4==0)return Y().setValue(o),I=d,void J();if((3072&e)>>10==2&&(48&e)>>4==0){if((48&e)>>4==0)return u=o,I=d,void J();if((48&e)>>4==1)return i=o,I=d,void J()}if((3072&e)>>10==3&&(48&e)>>4==0){if(I==s)return j().setValue((960&e)>>6),void(I=f);if(I==f)return W().setValue(W().READ_RAM),void(I=v);if(I==v)return o=H().getValue(),I=d,void J()}},L=function(e){q=e,I=d},N=function(e){if((3072&e)>>10==0)return a=o,o=u,u=a,I=d,void J();if((3072&e)>>10==1)return a=o,o=i,i=a,I=d,void J();if((3072&e)>>10==2){if(I==s){var t=1023&e;return j().setValue(t),void(I=g)}if(I==g)return W().setValue(W().READ_RAM),void(I=y);if(I==y)return a=H().getValue(),void(I=p);if(I==p)return H().setValue(o),void(I=M);if(I==M)return W().setValue(W().WRITE_RAM),o=a,I=d,void J()}},Q=function(e,t){var o=e+t;return r=o>255,o%256},X=function(e,t,o){var n=e+t;return o&&(n+=1),r=n>255,n%256},Z=function(e){if((3072&e)>>10==0)return o=Q(o,o),I=d,void J();if((3072&e)>>10==1){if(0==(3&e))return o=Q(o,u),I=d,void J();if(1==(3&e))return o=Q(o,i),I=d,void J()}if((3072&e)>>10==2){if(I==s){var t=1023&e;return j().setValue(t),void(I=x)}if(I==x)return W().setValue(W().READ_RAM),void(I=V);if(I==V)return a=H().getValue(),o=Q(o,a),I=d,void J()}return(3072&e)>>10==3?(o=Q(o,1023&e),I=d,void J()):void 0},$=function(e){if((3072&e)>>10==0)return o=X(o,o,r),I=d,void J();if((3072&e)>>10==1){if(0==(3&e))return o=X(o,u,r),I=d,void J();if(1==(3&e))return o=X(o,i,r),I=d,void J()}if((3072&e)>>10==2){if(I==s){var t=1023&e;return j().setValue(t),void(I=A)}if(I==A)return W().setValue(W().READ_RAM),void(I=R);if(I==R)return a=H().getValue(),o=X(o,a,r),I=d,void J()}return(3072&e)>>10==3?(o=X(o,1023&e,r),I=d,void J()):void 0},ee=function(e,t,o){var n=0;return e-t-(o=o?1:0)<0?(n=(e+=256)-t-o,r=!0):(n=e-t-o,r=!1),n},te=function(e){if((3072&e)>>10==0)return o=ee(o,o,r),I=d,void J();if((3072&e)>>10==1){if(0==(3&e))return o=ee(o,u,r),I=d,void J();if(1==(3&e))return o=ee(o,i,r),I=d,void J()}if((3072&e)>>10==2){if(I==s){var t=1023&e;return j().setValue(t),void(I=b)}if(I==b)return W().setValue(W().READ_RAM),void(I=m);if(I==m)return a=H().getValue(),o=ee(o,a,r),I=d,void J()}return(3072&e)>>10==3?(o=ee(o,1023&e,r),I=d,void J()):void 0},re=function(e){var t=e+1;return r=t>255,t%256},oe=function(e){if((3072&e)>>10==0)return o=re(o),I=d,void J();if((3072&e)>>10==1){if(0==(3&e))return u=re(u),I=d,void J();if(1==(3&e))return i=re(i),I=d,void J()}if((3072&e)>>10==2){if(I==s){var t=1023&e;return j().setValue(t),void(I=D)}if(I==D)return W().setValue(W().READ_RAM),void(I=_);if(I==_)return a=H().getValue(),a=re(a),void(I=C);if(I==C)return H().setValue(a),void(I=F);if(I==F)return W().setValue(W().WRITE_RAM),I=d,void J()}},ne=function(e){var t=e-1;return t<0?(e+=256,r=!0):r=!1,t},ue=function(e){if((3072&e)>>10==0)return o=ne(o),I=d,void J();if((3072&e)>>10==1){if(0==(3&e))return u=ne(u),I=d,void J();if(1==(3&e))return i=ne(i),I=d,void J()}if((3072&e)>>10==2){if(I==s){var t=1023&e;return j().setValue(t),void(I=U)}if(I==U)return W().setValue(W().READ_RAM),void(I=h);if(I==h)return a=H().getValue(),a=ne(a),void(I=O);if(I==O)return H().setValue(a),void(I=P);if(I==P)return W().setValue(W().WRITE_RAM),I=d,void J()}},ie=function(){var e=o*n;o=255&e,n=(65280&e)>>8,I=d,J()},ae=function(){var e=o;o=(e-e%n)/n,n=e%n,I=d,J()},se=function(e){if((3072&e)>>10==0)return o&=o,I=d,void J();if((3072&e)>>10==1){if(0==(3&e))return o&=u,I=d,void J();if(1==(3&e))return o&=i,I=d,void J()}if((3072&e)>>10==2){if(I==s){var t=1023&e;return j().setValue(t),void(I=E)}if(I==E)return W().setValue(W().READ_RAM),void(I=T);if(I==T)return a=H().getValue(),o&=a,I=d,void J()}},de=function(e){if((3072&e)>>10==0)return o|=o,I=d,void J();if((3072&e)>>10==1){if(0==(3&e))return o|=u,I=d,void J();if(1==(3&e))return o|=i,I=d,void J()}if((3072&e)>>10==2){if(I==s){var t=1023&e;return j().setValue(t),void(I=w)}if(I==w)return W().setValue(W().READ_RAM),void(I=S);if(I==S)return a=H().getValue(),o|=a,I=d,void J()}},le=function(e){if((3072&e)>>10==0)return o^=o,I=d,void J();if((3072&e)>>10==1){if(0==(3&e))return o^=u,I=d,void J();if(1==(3&e))return o^=i,I=d,void J()}if((3072&e)>>10==2){if(I==s){var t=1023&e;return j().setValue(t),void(I=k)}if(I==k)return W().setValue(W().READ_RAM),void(I=z);if(I==z)return a=H().getValue(),o^=a,I=d,void J()}},ce=function(){o=0,I=d,J()},fe=function(){o=255&~o,I=d,J()},ve=function(e){r||(q=e),I=d},Be=function(){return I==d?(j().setValue(q),console.log("address bus value setted "+j().getValue()),void G({CMD:t,CARRY_BIT:r,A:o,B:n,R0:u,R1:i,TEMP:a,state:I=l,pc:q,port:Y().getValue()})):I==l?(W().setValue(W().READ_ROM),console.log(W()),console.log("control bus value setted "+W().getValue()),void G({CMD:t,CARRY_BIT:r,A:o,B:n,R0:u,R1:i,TEMP:a,state:I=c,pc:q,port:Y().getValue()})):I==c?(t=H().getValue(),void G({CMD:t,CARRY_BIT:r,A:o,B:n,R0:u,R1:i,TEMP:a,state:I=s,pc:q,port:Y().getValue()})):I==s||I==f||I==v||I==B||I==g||I==y||I==p||I==M||I==x||I==V||I==A||I==R||I==b||I==m||I==D||I==_||I==C||I==F||I==U||I==h||I==O||I==P||I==E||I==T||I==w||I==S||I==k||I==z?(function(e){console.log("CMD "+e);var t=(61440&e)>>12,r=4095&e;switch(console.log(t),console.log(r),t){case 0:K(r);break;case 1:L(r);break;case 2:N(r);break;case 3:Z(r);break;case 4:$(r);break;case 5:te(r);break;case 6:oe(r);break;case 7:ue(r);break;case 8:ie();break;case 9:ae();break;case 10:se(r);break;case 11:de(r);break;case 12:le(r);break;case 13:ce();break;case 14:fe();break;case 15:ve(r)}}(t),void G({CMD:t,CARRY_BIT:r,A:o,B:n,R0:u,R1:i,TEMP:a,state:I,pc:q,port:Y().getValue()})):void 0};e.getPort=function(){return Y()},e.reset=function(){console.log("reset"),t=0,r=!1,o=0,n=0,u=0,i=0,a=0,I=d,q=0},_init=function(){e.setUpdateHandler("cpu",Be)},_init()},d={};n.extend(d),o.extend(d),d.produce=function(){var e={};return u.observer.extend(e),u.observable.extend(e),o.extend(e),n.extend(e),a(e),s(e),e.setUid(d.getUid()),e.setAddressBus(d.getAddressBus()),e.setControlBus(d.getControlBus()),e.setDataBus(d.getDataBus()),e.setPort(i.produce()),delete e.setUid,delete e.setAddressBus,delete e.setControlBus,delete e.setDataBus,delete e.getAddressBus,delete e.getControlBus,delete e.getDataBus,delete e.setPort,delete e.getPort,delete e.setUpdateHandler,delete e.updateObservers,e},e.exports.CPUFactory=d},function(e,t,r){var o=r(3).BusFactory,n={produce:function(){return o.setUid(-1),o.setMaxValue(5),o.produce()}};e.exports.PortFactory=n},function(e,t,r){var o=r(1).ObserverPattern,n=function(e){var t=1e3;e.setFrequency=function(e){t=e},e.getFrequency=function(){return t}},u=function(e){var t=null,r=e.updateObservers,o=e.getFrequency;e.on=function(){t||(t=setInterval(r,1e3/o()))},e.off=function(){t&&(clearInterval(t),t=null)}},i={};n(i),i.produce=function(){var e={};return o.observable.extend(e),n(e),u(e),e.setFrequency(i.getFrequency()),delete e.updateObservers,delete e.getFrequency,delete e.setFrequency,e},e.exports.OscillatorFactory=i}]);